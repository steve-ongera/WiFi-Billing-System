{% extends 'base.html' %}
{% load static %}

{% block title %}Connected Successfully!{% endblock %}

{% block content %}
<section class="pricing-card-area section-padding2">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-8 col-lg-10">
                <div class="text-center">
                    <div class="success-icon mb-4">
                        <i class="fas fa-check-circle" style="font-size: 80px; color: #28a745;"></i>
                    </div>
                    <h2 class="mb-3">You're Connected!</h2>
                    <p class="mb-4">Welcome to Wavex Internet. Your connection is now active.</p>
                    
                    <div class="connection-info bg-light p-4 rounded mb-4">
                        <h4>Connection Details</h4>
                        <p><strong>Session Expires:</strong> {{ expires_at|date:"M d, Y H:i" }}</p>
                        <p><strong>Amount Paid:</strong> ${{ session.payment_amount }}</p>
                        <p><strong>Status:</strong> <span class="text-success">Active</span></p>
                    </div>
                    
                    <!-- Countdown Timer Section -->
                    <div class="timer-section mb-4">
                        <div class="timer-box bg-primary text-white p-3 rounded">
                            <p class="mb-2"><strong>Time Remaining:</strong></p>
                            <div class="countdown display-4 font-weight-bold" id="countdown">Loading...</div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <a href="https://google.com" class="btn hero-btn me-3" target="_blank">Start Browsing</a>
                        <a href="{% url 'portal_login' %}" class="btn borders-btn">Back to Portal</a>
                    </div>
                    
                    <div class="mt-5">
                        <div class="alert alert-info">
                            <h5>Need Help?</h5>
                            <p>If you experience any connection issues, please contact our support team:</p>
                            <p><strong>Phone:</strong> (+84) 939 512 999 | <strong>Email:</strong> info@office.com</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
    .connection-info {
        border: 1px solid #e9ecef;
        background-color: #f8f9fa;
    }
    
    .success-icon {
        animation: bounce 1s ease-in-out;
    }
    
    @keyframes bounce {
        0%, 20%, 60%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-10px);
        }
        80% {
            transform: translateY(-5px);
        }
    }
    
    .me-3 {
        margin-right: 1rem;
    }
    
    .timer-section {
        max-width: 400px;
        margin: 0 auto;
    }
    
    .timer-box {
        background: linear-gradient(135deg, #007bff, #0056b3) !important;
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        border: none;
    }
    
    .countdown {
        font-family: 'Courier New', monospace;
        letter-spacing: 2px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .timer-expired {
        background: linear-gradient(135deg, #dc3545, #c82333) !important;
        animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
// Countdown timer
function updateCountdown() {
    const expiryTime = new Date('{{ session.expires_at|date:"c" }}').getTime();
    const now = new Date().getTime();
    const distance = expiryTime - now;
    
    const countdownElement = document.getElementById('countdown');
    const timerBox = document.querySelector('.timer-box');
    
    if (distance > 0) {
        const hours = Math.floor(distance / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        countdownElement.innerHTML = 
            String(hours).padStart(2, '0') + ':' + 
            String(minutes).padStart(2, '0') + ':' + 
            String(seconds).padStart(2, '0');
    } else {
        countdownElement.innerHTML = 'EXPIRED';
        timerBox.classList.add('timer-expired');
        
        // Show expiration message
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger mt-3';
        alertDiv.innerHTML = '<strong>Session Expired!</strong> Your internet access has ended. Redirecting to login page...';
        document.querySelector('.timer-section').appendChild(alertDiv);
        
        // Optionally redirect to login page after 5 seconds
        setTimeout(() => {
            window.location.href = '{% url "portal_login" %}';
        }, 5000);
    }
}

// Update countdown every second
setInterval(updateCountdown, 1000);
updateCountdown(); // Initial call
</script>
{% endblock %}